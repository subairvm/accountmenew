<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Monthly Report - Personal Finance</title>
<style>
:root {
  --bg:#071024;--card:#101c36;--text:#e6eef6;--accent:#3b82f6;
  --income:#10b981;--expense:#f97316;
}
body{font-family:Inter,Arial;background:var(--bg);color:var(--text);margin:0;padding:80px 0 40px;}
.navbar{background:#0b152b;position:fixed;top:0;left:0;right:0;padding:15px 0;z-index:1000;}
.nav-container{max-width:950px;margin:auto;display:flex;justify-content:space-between;align-items:center;padding:0 20px;}
.nav-logo{color:var(--text);font-weight:bold;text-decoration:none;font-size:1.2rem;}
.nav-links{list-style:none;display:flex;gap:20px;margin:0;padding:0;}
.nav-links a{color:var(--text);text-decoration:none;padding:5px 10px;border-radius:6px;}
.nav-links a:hover,.nav-links a.active{background:var(--accent);}
.container{max-width:950px;margin:auto;padding:20px;}
h1{font-size:1.6rem;}
.month-selector{background:var(--card);border-radius:10px;padding:16px;display:flex;align-items:center;gap:10px;margin-bottom:20px;}
.month-selector select,.btn{background:#1b2a4a;color:var(--text);border:1px solid #30456a;border-radius:6px;padding:6px 12px;cursor:pointer;}
.btn{background:var(--accent);border:none;color:white;}
.btn:hover{opacity:0.9;}
.stats-card{background:var(--card);padding:20px;border-radius:10px;margin-bottom:20px;}
.stats-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(180px,1fr));gap:16px;}
.stat-box{background:#162445;padding:20px;border-radius:8px;text-align:center;}
.stat-label{color:#9aa4b2;font-size:0.9rem;}
.stat-value{font-size:1.8rem;margin-top:6px;}
.income{color:var(--income);}
.expense{color:var(--expense);}
.saved-reports{background:var(--card);padding:20px;border-radius:10px;}
.saved-reports table{width:100%;border-collapse:collapse;}
.saved-reports th,.saved-reports td{border-bottom:1px solid #30456a;padding:8px;text-align:left;}
input.edit-field,input.edit-date{background:#1b2a4a;color:var(--text);border:1px solid #30456a;padding:4px 6px;border-radius:4px;width:90px;text-align:right;}
footer{text-align:center;color:#9aa4b2;font-size:0.8rem;padding-top:20px;}
</style>
</head>
<body>
<nav class="navbar">
  <div class="nav-container">
    <a href="#" class="nav-logo">My Account</a>
    <ul class="nav-links">
      <li><a href="index.html">Home</a></li>
      <li><a href="#" class="active">Monthly Report</a></li>
      <li><a href="privacy-policy.html">Privacy Policy</a></li>
    </ul>
  </div>
</nav>

<div class="container">
  <h1>Monthly Financial Report</h1>

  <div class="month-selector">
    <select id="month-select" onchange="generateReport()"></select>
    <button class="btn" onclick="generateReport()">Calculate</button>
    <button class="btn" onclick="saveMonthlyReport()">Save Report</button>
  </div>

  <div class="stats-card">
    <h2 style="margin-bottom:12px;">Calculated Totals</h2>
    <div class="stats-grid">
      <div class="stat-box">
        <div class="stat-label">Total Income</div>
        <div id="totalIncome" class="stat-value income">â‚¹0.00</div>
        <div id="incomeTx" class="stat-label">0 transactions</div>
      </div>
      <div class="stat-box">
        <div class="stat-label">Total Expense</div>
        <div id="totalExpense" class="stat-value expense">â‚¹0.00</div>
        <div id="expenseTx" class="stat-label">0 transactions</div>
      </div>
      <div class="stat-box">
        <div class="stat-label">Net Savings</div>
        <div id="netSavings" class="stat-value">â‚¹0.00</div>
        <div id="percentSaved" class="stat-label">0% saved</div>
      </div>
    </div>
  </div>

  <div class="saved-reports">
    <h2>Saved Monthly Reports (Editable)</h2>
    <table id="savedReportsTable">
      <thead>
        <tr>
          <th>Date</th><th>Total Income</th><th>Total Expense</th>
          <th>Net Savings</th><th>% Saved</th><th>Action</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>
  </div>
</div>

<footer>Â© Pravasi Seva Kendra Vazhikkadavu</footer>

<script>
const STORAGE_KEY='pe_app_v1';
const REPORTS_KEY='pe_saved_reports_v1';
let state={banks:[],transactions:[]};

if(!localStorage.getItem(STORAGE_KEY)){
  localStorage.setItem(STORAGE_KEY,JSON.stringify({
    banks:[{id:1,name:'SBI'},{id:2,name:'HDFC'}],
    transactions:[
      {date:'2025-11-01',type:'income',bankId:1,amount:15000,category:'Salary'},
      {date:'2025-11-05',type:'expense',bankId:1,amount:2000,category:'Food'},
      {date:'2025-11-10',type:'expense',bankId:2,amount:2500,category:'Travel'},
      {date:'2025-10-02',type:'income',bankId:2,amount:10000,category:'Bonus'},
      {date:'2025-10-04',type:'expense',bankId:2,amount:2500,category:'Shopping'}
    ]
  }));
}

function loadState(){
  try{state=JSON.parse(localStorage.getItem(STORAGE_KEY)||'{"banks":[],"transactions":[]}');}
  catch{state={banks:[],transactions:[]};}
}
function format(n){return 'â‚¹'+Number(n||0).toLocaleString('en-IN',{minimumFractionDigits:2});}
function sum(arr,k){return arr.reduce((s,x)=>s+(+x[k]||0),0);}
function getMonthlyTransactions(monthStr){
  const [y,m]=monthStr.split('-').map(Number);
  return state.transactions.filter(tx=>{
    const d=new Date(tx.date);
    return d.getFullYear()===y&&d.getMonth()===m-1;
  });
}
function calculateMonthlyStats(tx){
  const inc=tx.filter(t=>t.type==='income');
  const exp=tx.filter(t=>t.type==='expense');
  const income=sum(inc,'amount'),expense=sum(exp,'amount');
  const net=income-exp;const percent=income?((net/income)*100).toFixed(1):0;
  return {income,expense,net,percent,incomeCount:inc.length,expenseCount:exp.length};
}
function initializeMonths(){
  const sel=document.getElementById('month-select');
  const now=new Date();let opts='';
  for(let i=0;i<12;i++){
    const d=new Date(now.getFullYear(),now.getMonth()-i,1);
    const val=d.toISOString().slice(0,7);
    const lbl=d.toLocaleString('default',{month:'long',year:'numeric'});
    opts+=`<option value="${val}">${lbl}</option>`;
  }
  sel.innerHTML=opts;sel.value=now.toISOString().slice(0,7);
}
function updateTopTotalsFromSaved(r){
  document.getElementById('totalIncome').textContent=format(r.income);
  document.getElementById('totalExpense').textContent=format(r.expense);
  document.getElementById('netSavings').textContent=format(r.net);
  document.getElementById('percentSaved').textContent=`${r.percent}% saved`;
}
function generateReport(){
  const month=document.getElementById('month-select').value;
  const tx=getMonthlyTransactions(month);
  const s=calculateMonthlyStats(tx);
  updateTopTotalsFromSaved(s);
  document.getElementById('incomeTx').textContent=`${s.incomeCount} transactions`;
  document.getElementById('expenseTx').textContent=`${s.expenseCount} transactions`;
  return s;
}
function saveMonthlyReport(){
  const month=document.getElementById('month-select').value;
  const s=generateReport();
  let reps=JSON.parse(localStorage.getItem(REPORTS_KEY)||'[]');
  const ex=reps.find(r=>r.month===month);
  const data={month,...s};
  if(ex)Object.assign(ex,data);else reps.push(data);
  localStorage.setItem(REPORTS_KEY,JSON.stringify(reps));
  loadSavedReports();alert('Report saved successfully!');
}
function loadSavedReports(){
  const reps=JSON.parse(localStorage.getItem(REPORTS_KEY)||'[]');
  const tb=document.querySelector('#savedReportsTable tbody');
  tb.innerHTML='';
  reps.forEach((r,i)=>{
    const tr=document.createElement('tr');
    tr.innerHTML=`
      <td><input type="month" class="edit-date" id="month_${i}" value="${r.month}" onchange="reflectToTop(${i})"></td>
      <td><input type="number" class="edit-field" id="income_${i}" value="${r.income}" oninput="recalc(${i},true)"></td>
      <td><input type="number" class="edit-field" id="expense_${i}" value="${r.expense}" oninput="recalc(${i},true)"></td>
      <td><input type="number" class="edit-field" id="net_${i}" value="${r.net}" readonly></td>
      <td><input type="number" class="edit-field" id="percent_${i}" value="${r.percent}" readonly></td>
      <td>
        <button class="btn" style="padding:4px 8px;" onclick="updateReport(${i})">ðŸ’¾</button>
        <button class="btn" style="background:#e74c3c;padding:4px 8px;" onclick="deleteReport(${i})">ðŸ—‘</button>
      </td>`;
    tb.appendChild(tr);
  });
}
function recalc(i,reflect){
  const inc=+document.getElementById(`income_${i}`).value||0;
  const exp=+document.getElementById(`expense_${i}`).value||0;
  const net=inc-exp;const perc=inc?((net/inc)*100).toFixed(1):0;
  document.getElementById(`net_${i}`).value=net;
  document.getElementById(`percent_${i}`).value=perc;
  if(reflect){
    updateTopTotalsFromSaved({income:inc,expense:exp,net:net,percent:perc});
  }
}
function reflectToTop(i){
  const inc=+document.getElementById(`income_${i}`).value||0;
  const exp=+document.getElementById(`expense_${i}`).value||0;
  const net=inc-exp;const perc=inc?((net/inc)*100).toFixed(1):0;
  updateTopTotalsFromSaved({income:inc,expense:exp,net:net,percent:perc});
}
function updateReport(i){
  const reps=JSON.parse(localStorage.getItem(REPORTS_KEY)||'[]');
  reps[i]={
    month:document.getElementById(`month_${i}`).value,
    income:+document.getElementById(`income_${i}`).value||0,
    expense:+document.getElementById(`expense_${i}`).value||0,
    net:+document.getElementById(`net_${i}`).value||0,
    percent:+document.getElementById(`percent_${i}`).value||0
  };
  localStorage.setItem(REPORTS_KEY,JSON.stringify(reps));
  loadSavedReports();alert('Report updated!');
}
function deleteReport(i){
  if(!confirm('Delete this report?'))return;
  const reps=JSON.parse(localStorage.getItem(REPORTS_KEY)||'[]');
  reps.splice(i,1);
  localStorage.setItem(REPORTS_KEY,JSON.stringify(reps));
  loadSavedReports();
}
loadState();initializeMonths();generateReport();loadSavedReports();
</script>
</body>
</html>
